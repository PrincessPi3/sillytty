# set -e # stop on errorz
### `curl https://raw.githubusercontent.com/PrincessPi3/sillytty/refs/heads/master/install-sillytty | bash`

SILLYDEV=$HOME/dev
RCFILE=$HOME/.bashrc
# SILLYPACKAGES=netcat-openbsd socat picocom wget screen

# echo "updating repo"
# pkg update

# echo "upgrading software"
# pkg upgreade``

# echo "installing preerquisites"
# pkg install $SILLYPACKAGES

wget https://raw.githubusercontent.com/PrincessPi3/sillytty/refs/heads/master/START-SILLYTTY -O $PATH/START-SILLYTTY
echo $?

echo "downloading STOP-SILLYTTY"
wget https://raw.githubusercontent.com/PrincessPi3/sillytty/refs/heads/master/STOP-SILLYTTY -O $PATH/STOP-SILLYTTY
echo $?

echo "downloading UNINSTALL-SILLYTTY"
wget https://raw.githubusercontent.com/PrincessPi3/sillytty/refs/heads/master/UNINSTALL-SILLYTTY -O $PATH/UNINSTALL-SILLYTTY
echo $?

echo "downloading VARDUMP-SILLYTTY"
wget https://raw.githubusercontent.com/PrincessPi3/sillytty/refs/heads/master/VARDUMP-SILLYTTY -O $PATH/VARDUMP-SILLYTTY
echo $?

echo "making START-SILLYTTY executable"
chmod +x $PATH/START-SILLYTTY
echo $?

echo "making STOP-SILLYTTY executable"
chmod +x $PATH/STOP-SILLYTTY
echo $?

echo "making UNINSTALL-SILLYTTY executable"
chmod +x $PATH/UNINSTALL-SILLYTTY
echo $?

echo "making VARDUMP-SILLYTTY executable"
chmod +x $PATH/VARDUMP-SILLYTTY
echo $?

SILLYVARS='SILLYDEV="$HOME/dev"\nSILLYTTY="$SILLYDEV/sillypty"\nSILLYPTY="$SILLYDEV/sillypty"\nSILLYPIPE="$SILLYDEV/sillypipe"\nSILLYHOST="localhost"\nSILLYPORT=31337\nSILLYPROTO="tcp"\nSILLYBAUD=115200\nalias PICOSILLY="picocom -b $SILLYBAUD $SILLYPTY"\nalias NC-SILLYTTY="nc $SILLYHOST $SILLYPORT"\nalias SOCAT-SILLYTTY="socat - $SILLYPROTO:$SILLYHOST:$SILLYPORT"\nalias PROBESILLYDEV="file $SILLYDEV/*;ls -lah $SILLYDEV"\nalias KILLSILLYSOCAT="killall socat; killall nc; rm -f $SILLYDEV/*"\nalias TTYSILLYTTY="socat -d pty,link=$SILLYPTY,b$SILLYBAUD,raw,echo=0,nonblock $SILLYPROTO:$SILLYHOST:$SILLYPORT &"\n'

# SILLYVARS+='alias newpty="socat pty,link=$SILLYPTY,raw,group-late=everybody,mode=666 $SILLYPROTO:$SILLYHOST:$SILLYPORT &"\n'
# SILLYVARS+='alias NEWPTY="socat pty,link=$SILLYPTY,raw $SILLYPROTO:$SILLYHOST:$SILLYPORT &"\n'
SILLYVARS+="alias MKPIPE-SILLYTTY='mkfifo $SILLYPIPE; sleep 1; nc $SILLYHOST $SILLYPORT > $SILLYPIPE &';alias SOPIPE-SILLYTTY='socat -d -d pty,raw,echo=0,link=$SILLYPTY,mode=0666,nonblock,b`echo $SILLYBAUD` $SILLYPIPE &'; alias PIPECONNECT-SILLYTTY='MKPIPE-SILLYTTY; sleep 3; SOPIPE-SILLYTTY; PROBESILLYDEV; sleep 1; picocom -b $SILLYBAUD $SILLYPTY'"


if [ ! -d "$SILLYDEV" ]; then
        echo "$SILLYDEV not found, creating"
        mkdir $SILLYDEV
        echo $?
fi

echo "touching $RCFILE"
touch $RCFILE
echo $?

echo "appending vars and alias to $RCFILE"
echo -e $SILLYVARS >> $RCFILE
echo $?

echo "DONE! RESTART TERMUX"

exit