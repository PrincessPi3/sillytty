# set -e # stop on errorz
### `curl https://raw.githubusercontent.com/PrincessPi3/sillytty/refs/heads/master/install-sillytty | bash`

SILLYDEV=$HOME/dev
RCFILE=$HOME/.bashrc
# SILLYPACKAGES=netcat-openbsd socat picocom wget

# echo "updating repo"
# pkg update

# echo "upgrading software"
# pkg upgreade``

# echo "installing preerquisites"
# pkg install $SILLYPACKAGES

echo "downloading start-sillytty"
wget https://raw.githubusercontent.com/PrincessPi3/sillytty/refs/heads/master/start-sillytty -O $PATH/start-sillytty
echo $?

echo "downloading stop-sillytty"
wget https://raw.githubusercontent.com/PrincessPi3/sillytty/refs/heads/master/stop-sillytty -O $PATH/stop-sillytty
echo $?

echo "downloading uninstall-sillytty"
wget https://raw.githubusercontent.com/PrincessPi3/sillytty/refs/heads/master/uninstall-sillytty -O $PATH/uninstall-sillytty
echo $?

echo "downloading vardump-sillytty"
wget https://raw.githubusercontent.com/PrincessPi3/sillytty/refs/heads/master/vardump-sillytty -O $PATH/vardump-sillytty
echo $?

echo "making start-sillytty executable"
chmod +x $PATH/start-sillytty
echo $?

echo "making stop-sillytty executable"
chmod +x $PATH/stop-sillytty
echo $?

echo "making uninstall-sillytty executable"
chmod +x $PATH/uninstall-sillytty
echo $?

echo "making vardump-sillytty executable"
chmod +x $PATH/vardump-sillytty
echo $?

SILLYVARS='SILLYDEV="$HOME/dev"\nSILLYTTY="$SILLYDEV/sillypty"\nSILLYPTY="$SILLYDEV/sillypty"\nSILLYPIPE="$SILLYDEV/sillypipe"\nSILLYHOST="localhost"\nSILLYPORT=31337\nSILLYPROTO="tcp"\nSILLYBAUD=115200\nalias picosilly="picocom -b $SILLYBAUD $SILLYPTY"\nalias nc-sillytty="nc $SILLYHOST $SILLYPORT"\nalias socat-sillytty="socat - $SILLYPROTO:$SILLYHOST:$SILLYPORT"\nalias PROBESILLYDEV="file $SILLYDEV/*;ls -lah $SILLYDEV"\nalias KILLSILLYSOCAT="killall socat; killall nc; rm -f $SILLYDEV/*"\nalias TTYSILLYTTY="socat -d pty,link=$SILLYPTY,b$SILLYBAUD,raw,echo=0,nonblock $SILLYPROTO:$SILLYHOST:$SILLYPORT &"\n'

SILLYVARS+='alias newpty="socat pty,link=$SILLYPTY,raw,group-late=everybody,mode=666 $SILLYPROTO:$SILLYHOST:$SILLYPORT &"\n'

if [ ! -d "$SILLYDEV" ]; then
        echo "$SILLYDEV not found, creating"
        mkdir $SILLYDEV
        echo $?
fi

echo "touching $RCFILE"
touch $RCFILE
echo $?

echo "appending vars and alias to $RCFILE"
echo -e $SILLYVARS >> $RCFILE
echo $?

echo "DONE! RESTART TERMUX"